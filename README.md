MTWM-Solver: 複数ターゲット混合における廃棄物最小化ソルバー
概要
本プロジェクトは、**複数ターゲットの混合液（Multi-Target）**を生成する過程において、**廃棄物（Waste）を最小化（Minimization）**するための最適化計算を行うソルバーです。

指定された複数の目標混合比率（ターゲット）に対し、試薬の混合、中間生成物の共有などを考慮して、総廃棄量が最も少なくなるような混合手順を探索します。最適化にはZ3 Theorem Proverを利用しています。

特徴
廃棄物の最小化: 中間生成物を他の混合プロセスで再利用することで、全体の廃棄量を最小化します。

複数ターゲットの同時最適化: 複数の異なる混合比率の液体を同時に生成する際の最適な手順を計算できます。

チェックポイント機能: 最適化計算は時間がかかる場合があります。このソルバーは計算の途中経過を自動で保存し、中断した箇所から計算を再開できます。

可視化レポート: 最適化された混合手順は、直感的に理解しやすいツリー形式の画像として出力されます。

ファイル構成
リファクタリング後のプロジェクトは、以下のファイルで構成されています。

MTWM_2/
├── main.py                 # 全体の処理フローを制御するメインスクリプト
├── config.py               # 最適化したいターゲット（混合比率や分割係数）を設定するファイル
├── mtwm_model.py           # 最適化問題の構造（ツリー構造や変数）を定義するクラス
├── z3_solver.py            # Z3ソルバーへの制約条件設定や最適化実行を管理するクラス
├── reporting.py            # 結果のサマリー出力や可視化を担当するクラス
└── checkpoint_handler.py   # 計算の中断・再開を実現するチェックポイント機能を管理するクラス
使い方
1. ターゲットの設定
まず、config.pyファイルを開き、get_targets_config()関数内に生成したい混合液の情報を記述します。

name: ターゲットの名称（レポート出力用）

ratios: 試薬の混合比率（例: [10, 55, 25]）

factors: 混合プロセスにおける分割係数

Python

# config.py の設定例
def get_targets_config():
    return [
        {'name': 'Target 1', 'ratios': [10, 55, 25], 'factors': [5, 3, 3, 2]},
        {'name': 'Target 2', 'ratios': [12, 5, 1], 'factors': [3, 3, 2]},
        {'name': 'Target 3', 'ratios': [5, 6, 14], 'factors': [5, 5]},
    ]
2. 最適化の実行
設定が完了したら、main.pyを実行します。

Bash

python main.py
ソルバーは最適解を探索し始め、より良い解（廃棄物が少ない手順）が見つかるたびに、コンソールに進捗状況とチェックポイントの保存を通知します。

計算を途中で中断したい場合は、Ctrl+Cを押してください。その時点で見つかっている最良の解が報告されます。

3. 結果の確認
計算が完了または中断されると、結果が格納されたディレクトリが生成されます。ディレクトリ名は、設定したターゲットの混合比率に基づいて自動的に命名されます（例: (10_55_25)-(12_5_1)-(5_6_14)_volNone）。

出力される内容は以下の通りです。

コンソールへのサマリー表示:

最小廃棄物量

総混合操作回数

総試薬使用量

各試薬の使用量の内訳

summary.txt:

コンソール表示よりも詳細なレポート。

各ターゲットの混合プロセス（どのノードで、何を、どれだけ混ぜるか）がステップごとに記述されています。

mixing_tree_visualization.png:

最適化された混合手順を可視化したフロー図。

丸で囲まれた数字（①, ②, ...）は試薬を表し、矢印に付記された数字は移動する液量を示します。

緑色のノードが最終的なターゲット混合液です。

チェックポイント機能について
自動保存: より廃棄物の少ない解が見つかるたびに、checkpoint_xxxxxxxx.pklという名前のファイルが自動で生成されます。ファイル名のハッシュ値は、config.pyの設定内容から計算されるため、設定ごとに進捗が管理されます。

自動再開: main.pyを実行すると、まず同じ設定のチェックポイントファイルを探しに行きます。ファイルが存在すれば、前回の計算結果（最小廃棄物量）を読み込み、それよりも良い解の探索から計算を再開します。

リセット: 計算を最初からやり直したい場合は、対応する.pklファイルを削除してください。